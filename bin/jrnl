#!/bin/bash
set -eu
dir=~/programming/obs/journal
if [ ! -d "$dir" ]; then echo "$dir does not exist"; exit 127; fi
_args=()
case "${1:-}" in
 -y|--yesterday)
    case "$(uname -s | tr '[:upper:]' '[:lower:]')" in
      darwin) _args+=("-v1d") ;;
      *) _args+=( -d "yesterday 13:00");;
    esac
    ;;
 *) exit 1;;
esac
dir="$dir/$(date "${_args[@]}" +%Y/%m)"
mkdir -p "$dir"
cd "$dir"
file="$(date "${_args[@]}" +%d).md"
if [ ! -f  "$file" ]; then 
  echo "---
        date: $(date +%Y-%m-%d)
        ---
        " | sed 's/^        //g' > "$file"
fi
${EDITOR:-vi} "$file"
